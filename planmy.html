<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="UTF-8">
		<title>Plan My</title>
		<style>
				#cuerpo {width: 80%;height: 100%;visibility: visible; display: all;  margin: 0 auto;}
			
			
				.resultado{
				    text-align: center;
		            font-family: "Lucida Grande", Tahoma, Verdana, sans-serif;
		            font-weight: normal;
		            font-size: 2.5rem;
				}
	
		        .conjunto-botones {
		            display: flex;
		            margin-bottom: 5px;
		            overflow: hidden;
		            justify-content: center;
				    width: auto;
		        }

		        .conjunto-botones input {
		            position: absolute !important;
		            clip: rect(0, 0, 0, 0);
		            height: 1px;
		            width: 1px;
		            border: 0;
		            overflow: hidden;
		        }

		        .conjunto-botones label {
		            background-color: #f2f2f2;
		            color: rgba(0, 0, 0, 0.6);
		            font-size: 1.5rem;
		            line-height: 1;
		            text-align: center;
		            padding: calc(6px + 0.5vw) calc(5px + 2vw);
		            margin-right: -1px;
		            border: 1px solid rgba(0, 0, 0, 0.2);
		            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px rgba(255, 255, 255, 0.1);
		            transition: all 0.1s ease-in-out;
		        }
		
				.conjunto-botones label.tres {
					width: calc(33.33% - 5px);
				}
		
				.conjunto-botones label.cinco {
					width: calc(20% - 5px);
				}
		
		        .conjunto-botones label:hover {
		            cursor: pointer;
		        }

		        .conjunto-botones input:checked + label {
		            background-color: #c1c1c1 ;
		            box-shadow: none;
					color: #000000;
		        }

		        .conjunto-botones input:disabled + label {
		            background-color: #d9d9d9;
					color: #b8b8b8;
		            box-shadow: none;
		        }

		        .conjunto-botones label:first-of-type {
		            border-radius: 4px 0 0 4px;
		        }

		        .conjunto-botones label:last-of-type {
		            border-radius: 0 4px 4px 0;
		        }

		        .form {
		            font-family: "Lucida Grande", Tahoma, Verdana, sans-serif;
		            font-weight: normal;
		            line-height: 1.625;
		            max-width: 100vw;
		        }

		        h2 {
		            font-size: 2rem;
		            margin-bottom: 1px;
		        }

				.link_precio:link, .link_precio:visited {
				  background-color: #f2f2f2;
				  color: black;
				  text-decoration: none;
				}

				.link_precio:hover, .link_precio:active {
				  background-color: gray;
				  color: white;
				}

				@media only screen and (max-width: 600px) {	
			
					#cuerpo {width: 95%;height: 100%;visibility: visible; display: all;  margin: 0 auto;}
			
		            .conjunto-botones label {
		                font-size: 0.9rem;
		                padding: calc(7px + 0.7vw) calc(3px + 0.4vw);
		            }
			
					.resultado{
			            font-size: 1rem;
					    text-align: left;
					}
			
			        h2 {
			            font-size: 1.5rem;
			            margin-bottom: 1px;
			        }
		        }
		</style>
	</head>
	<body translate="no">
		<div id="cuerpo">
			<form class="form">
				<h2>Simulador Plan My</h2>
				<br>
				<div class="conjunto-botones iphone">
					<input type="radio" id="iphone12" name="boton">
					<label class="tres" for="iphone12">iPhone 12</label>
					<input type="radio" id="iphone13" name="boton">
					<label class="tres" for="iphone13">iPhone 13</label>
					<input type="radio" id="iphone14" name="boton">
					<label class="tres" for="iphone14">iPhone 14</label>
				</div>
			</form>
			<form class="form">
				<div class="conjunto-botones">
					<input type="radio" id="normal" name="boton">
					<label class="cinco" for="normal">Normal</label>
					<input type="radio" id="mini" name="boton">
					<label class="cinco" for="mini">Mini</label>
					<input type="radio" id="plus" name="boton">
					<label class="cinco" for="plus">Plus</label>
					<input type="radio" id="pro" name="boton">
					<label class="cinco" for="pro">Pro</label>
					<input type="radio" id="promax" name="boton">
					<label class="cinco" for="promax">Max</label>
				</div>
			</form>

			<form class="form">
				<div class="conjunto-botones">
					<input type="radio" id="64gb" name="boton">
					<label class="cinco" for="64gb">64Gb</label>
					<input type="radio" id="128gb" name="boton">
					<label class="cinco" for="128gb">128Gb</label>
					<input type="radio" id="256gb" name="boton">
					<label class="cinco" for="256gb">256Gb</label>
					<input type="radio" id="512gb" name="boton">
					<label class="cinco" for="512gb">512Gb</label>
					<input type="radio" id="1tb" name="boton">
					<label class="cinco" for="1tb">1Tb</label>
				</div>
				<br />
				<div id ='resultado' class="resultado">
				</div>
			</form>
		</div>

  
		<script type="text/javascript">
			var datos;
			var datos_json;
			
			var btn_iphone12 = document.getElementById("iphone12");
			var btn_iphone13 = document.getElementById("iphone13");
			var btn_iphone14 = document.getElementById("iphone14");			
			var btn_normal = document.getElementById("normal");
			var btn_mini = document.getElementById("mini");
			var btn_plus = document.getElementById("plus");
			var btn_pro = document.getElementById("pro");
			var btn_promax = document.getElementById("promax");
			var btn_64 = document.getElementById("64gb");
			var btn_128 = document.getElementById("128gb");
			var btn_256 = document.getElementById("256gb");
			var btn_512 = document.getElementById("512gb");
			var btn_1tb = document.getElementById("1tb");
            var txt_resultado = document.getElementById("resultado");
			
			var array_botones = [btn_iphone12, btn_iphone13, btn_iphone14, btn_normal, btn_mini, btn_plus, btn_pro, btn_promax, btn_64, btn_128, btn_256, btn_512, btn_1tb];
			
			function estadoBotones (estado){
				btn_normal.disabled = estado;
				btn_mini.disabled = estado;
				btn_plus.disabled = estado;
				btn_pro.disabled = estado;
				btn_promax.disabled = estado;
				btn_64.disabled = estado;
				btn_128.disabled = estado;
				btn_256.disabled = estado;
				btn_512.disabled = estado;
				btn_1tb.disabled = estado;
			}
	
			array_botones.forEach((elem) => {
				elem.addEventListener("change", actualiza);
			});
	
			let labels = document.getElementsByTagName('label');
			for (var i = 0; i < labels.length; i++) {
				if (labels[i].htmlFor != '') {
					let elem = document.getElementById(labels[i].htmlFor);
					if (elem)
						elem.label = labels[i];         
				}
			}
	
			function redondea(valor){
				if (Number.EPSILON === undefined) {
					Number.EPSILON = Math.pow(2, -52); //Hay que meter esto para que funcione en IE11
				}
				return (Math.round((valor + Number.EPSILON) * 100) / 100);
			}
	
			function CambiarPrecio(precio) {	
				let nuevo_precio = parseInt(prompt("Introduce el precio", precio));
				if (nuevo_precio != null && !isNaN(nuevo_precio)) {
					actualiza(null,nuevo_precio);
				}
			}
	
			function realizaCalculos(modelo, nuevo_precio){

				if (nuevo_precio == null) {
					precio = datos_json[modelo].PVP;
				}
				else
				{
					precio = nuevo_precio;
				}				  
				fv = datos_json[modelo].VR;
				rate = 6.95/100/12;
				nper = 24;
				pv = -precio-18;
				pvif = Math.pow(1 + rate, nper);
				pmt = - rate * (pv * pvif + fv) / (pvif - 1);
				intereses = ((pmt*nper)+fv)-precio;
				codigo_enlace = '<a class="link_precio" title="Pulsa para modificar el precio" href="#" onclick="CambiarPrecio(' + precio+');return false;">';				 
				texto_resultado = modelo + ': '+codigo_enlace+'<b>'+precio+" €</b></a><br/>";
				texto_resultado += nper +' cuotas de <b>'+redondea(pmt)+ '€</b><br>';
				texto_resultado += 'Y una última cuota de <b>'+redondea(fv)+' €</b><br>';
				texto_resultado += 'Pagando <b>'+redondea(intereses)+ ' €</b> de intereses (incluidos en la cuota)';
                txt_resultado.innerHTML = texto_resultado;	
			}
	
			function actualiza(e, nuevo_precio) {
				let item = event.target.id;
				if (item=='iphone12'){
					estadoBotones(true);
					btn_normal.disabled = false;
					btn_64.disabled = false;
					btn_128.disabled = false;
					btn_256.disabled = false;
				}
				if (item=='iphone13'){
					estadoBotones(false);
					btn_plus.disabled = true;
					btn_64.disabled = true;
					btn_1tb.disabled = true;
		 	   }
			   if (item=='iphone14'){
				   estadoBotones(false);
				   btn_mini.disabled = true;
				   btn_64.disabled = true;
			  }
			  if ((btn_iphone14.checked == true) && ((btn_pro.checked== true) || (btn_promax.checked== true))){
				  btn_1tb.disabled = false;
			  }
			  else {
				  btn_1tb.disabled = true;
			  	
			  }
			  
			  let modelo = '';	  
			  array_botones.forEach((elem) => {
				  if (elem.checked==true) {
					  let espacio = modelo ? ' ' : '';
					  let item_seleccionado = document.getElementById(elem.id).label.innerHTML;
					  if (item_seleccionado == 'Max') item_seleccionado = 'Pro Max';
					  modelo = modelo+espacio+item_seleccionado;
					  modelo = modelo.replace('Normal ', '');
					  if (datos_json.hasOwnProperty(modelo)){
						  realizaCalculos(modelo, nuevo_precio);
					  }

				  }
			  });
			};
  
			async function decrypt(texto) {
    
				// Este es el texto de apoyo del programa. Está encriptado por el tipo de datos que se usan
				let cipherHex  = "cc3dffeaa571836ea9382c17c8ab2b31a973f767b3c3689e575559cdbc755b91ea9875660d338183190be11e5db7f69282726e89ee413d97f5ddd1d99bf85ca62dd8af3ff6aaa6cddb89b13a9c6ebf97b54e4e167d895c898534e157b928c40d8bf7b815ba0b0781a3c91c86a582aea9324e2643d48d3b75c90761ffdcfd171e9b3e0852f3e03f11a00745433a6b9b10c45dabbe034bfdc094c4463f40643311b1700d3b6f616f4c6347434d1c7ac0ee210e273190d9846e62562dcc27e8641af6f1d6e5dc3ff9f508dacb61944151f272ef77ae11127cfca4a880bff670d861aaea2e28782ab5cfa3c48cd844fe57a939543419664ec17faf8f9e09ab9b649b10c83b20c3081c5351df881bf44fe7da9532e072dd8c781d83fe41cc0a3b5c4ce3b4b2c33c1f57e7a437af46f3fc3e97a5c716a527dbda3e9925448e2da37cbbd3de440a193cd1dc5e4a12286b2a30132b17a815b289c5a2167cb7cb69f41e4d77756533e5e2e804d504c964a8a339c4dbf91b04519c9e4a5a5cc0448791fce3cb30ea0d344c4f89fe85796c36918d7249aa73827eaae771257188bb74ba2545066f11b6e6d7443a143fcd81f298f64dcf06ca677d7a0871f3eb856d374797bb41fac88fc0d67790e0ddbcf4d025c8bde8b5b131b86359ad2702fcc2f2502749e3d530e86cf034e51d00a9f8350003b4309a0a9c969b6bcc15dcac0f5ea5abac380a6126cd2bcc902fd068ba09fe6a20f343529304cea0cadd352cda4250087212a032e06dcfe0e6e25cfd7289625379af517ed270886d2e47ad0709b6a5e87b0e2646767cd18b8d25291d56a130e4975f49c09b9992eb037248868029f61392c1b7f2026109650c9190204fa0692645e7c92b4dc1bb9cf28cc8a559fbf882f8f318d777a5f83dc519c7985bcb97ccfcd8e125128c7bced933aeb01d1e810a5b98d556e3908e8f3c334f9690e9ae7120d8946e2fd04d543c8caf7af236b16924ade466d81ae14794520f0f03421ce7928d6f4ff41237009ee48f5b0910a73ab4bb9077b54772b2353b240fc9259f3008a9225e16a1e6cee179354dd8ca27784e2dac154132d0513a624f2f74fcdd22d3a44f691a43bffd1145c287be5c1ec4693114932d5f46f8acee76fbc957a724fb040d7d935cc185e976463c062eea4733bde530f0c2b57df6855706c5cfd93c2d555391d11faaea11bdc3515569917cba725c8f22eb49c93b836e1a89f29905e03887aafcb6f264562319b1031535e50581e8c5587ac5e843c36d05f123b1f1dc4f652d793148c98bc4b665c0f5b1d261188427c815a00f89dcaf280d1d8d1aa85a6320767f8e7a12c0fade54b7edece3ee97de75c8583b54cc46bb8a02736af25309c4f24d85a333eeec683fd43ed65121f9dbe81ee0a0d73881a82de09fbab604c6eaba637eb6f77a871cb0b09ea3962aa95db4c5b825c1cc98c4b24fe4e4226ed6a624417d127c8ae1545137aab65ddb2fa63d5ff3fb7e13f8ea08e9ab2a818a8fa51aca9fde6e5e2b3165f2fa43aa644d4b501048369201133bb97b2ee76abcb942a74471085e340496795ab9d83c92ea6c8593c90b7e1062cd72d6dc14d4f12581b24a1e62b3adcca11805299206b0a5f7ad667852cadd7c05c1d90074fcd78001908eb04ba940217fd3f228413e78cf0e00d576243570c08eacb2ec8556f5c625f463fcdf3b843c1729b9a23c578f7b19c79fc7aa28acd0395c63d5792dc64b9d4e8b9922e8c403746f80040bc52859ebac2399e2005ce0ac6c1f5cbe092e833be7bf92e42da77a1159ce0d350d8f8a752ea0e07fba6f6c87eca4a37b18aaa8c85859c62b4d6e8ca4b874b92c826f9f8ae174d6ec55c24a1105fbf57448b2f58e24ceb57034b2f5bf21d5143740203ed613cb12d6264483d2bd8566b4f8d330001b724db614f135c05da69a0cbf4c989d7ff3fb06f066b5bb05b79266b652ef6ac98b48be870744800c518a04c3fbed858f2af447016fd83c9c4c1a7ce4ef6b0869320f0e37ab57e74c80e25338ae1211802200146102c4fd98cbf381b2e15dbe24552c81cb76e0ec9ce71d2b1261a74dea84fab39ad497e57d6b04e57d4d5fcfe66e9350987f8cfd2f50c3a34be654f8263b3bb7d267f60bac64a5ca9f9f6f62610e58345b120bf6e4948e8fa81459bb41b8fb821ce844bff489458ab81a9f5cd409a0d57f17d6b450fc656e5d004062495e9214e56c0cc3ce29c4272a"
	
				// Funciones de apoyo
				function hexStringToBytes(input) {
					for (var bytes = [], c = 0; c < input.length; c += 2) {
						bytes.push(parseInt(input.substr(c, 2), 16));
					}
					return Uint8Array.from(bytes);
				}
		
				function removePadding(input) {
					padAmount = input[input.length-1]
					unpaddedSize = input.length - padAmount
					return input.slice(0, unpaddedSize)
				}	  
  
				// Código de desencriptación. ivHex y saltHex no cambian entre webs. Siempre uso la misma.
				const saltHex    = "55de388d8fd8e67b6da0e68d4022e444"
				const ivHex      = "05998ad87dde9461c89b50cc97ebbb8e"
				let salt = hexStringToBytes(saltHex)
				let iv = hexStringToBytes(ivHex)
				let password = new TextEncoder().encode(texto)
				let passwordKey = await window.crypto.subtle.importKey("raw", password,{name: "PBKDF2"},false,["deriveKey"])
				let key = await window.crypto.subtle.deriveKey({name: "PBKDF2",salt: salt,iterations: 1000000,hash: "SHA-1",},passwordKey, {name: "AES-GCM",length: 32 * 8, },false, ["decrypt"])
				let cipher = hexStringToBytes(cipherHex)
				let decryptedBuffer = await window.crypto.subtle.decrypt({name: "AES-GCM", iv: iv, },key,cipher)
				decrypted = removePadding(new Uint8Array(decryptedBuffer))
				plainText = new TextDecoder().decode(decrypted)
				// Hace visible el cuerpo de la web, para que se pueda usar el programa. Los datos desencriptados se guardan en la variable "datos"
				document.getElementById("cuerpo").style.display="block";
				datos = plainText;
			}
			
			estadoBotones(true);
			
			document.getElementById("cuerpo").style.display="none";
			pass = prompt("Contenido protegido. Introduce la contraseña: ")
			decrypt(pass).then(function() {	 
				datos_json = JSON.parse(datos);
		    });
		</script>
	</body>
</html>