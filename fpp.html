<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
		<style type="text/css" media="print">
			body {visibility: hidden; display: none;}
		</style>
        <style type="text/css">
			* {box-sizing: border-box;}
			
    		body {
        		font: 1.2em Helvetica, arial, sans-serif;
			max-width: 1000px;
  margin: auto;
    		}
			
    		a:link, a:visited {
      		  	text-decoration: none;
      		  	color: #f08c00;
    	  	}

			h1 {
      		  	text-align: center;
      		  	margin: 0;
      		  	padding: 10px;	
        		font: 1.2em Helvetica, arial, sans-serif;
							
			}

    		h2 {
      		 	background-color: #A9A9A9	;
      		  	color: #fff;
      		  	text-align: center;
      		  	margin: 0;
      		  	padding: 10px;
    	  	}
	
			.encabezado {
	  		  	list-style: none;
	  			margin: 1em;
	  		  	display: grid;
	  			grid-gap: 20px;
	  		  	grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
			}

			.encabezado li {
	  		  	border: 1px solid #808080;
	  		  	border-radius: 5px;
	  		  	display: flex;
	  		  	flex-direction: column;
			}
	
			.encabezado .cls_input {
    			font: 2.2em Helvetica, arial, sans-serif;
    			border: 0;
    			text-align: center;
				width:90%;
			}

			.encabezado .cls_div {
    			margin: auto auto;
    			display: flex;
    			justify-content: center;
    			align-items: center;
			}

			.encabezado .cls_interes {
	  		  	margin-top: auto;
	  		  	border-top: 1px solid #808080;
	  		  	padding: 5px;
	  		  	text-align: center;
			}
			
			.encabezado .cls_cuota {
	  		  	padding: 5px;
	  		  	text-align: center;
  		  	}

			.listing {
  			  	list-style: none;
  			  	margin: 1em;
  			  	display: grid;
  			  	grid-gap: 20px;
  			  	grid-template-columns: repeat(auto-fill,minmax(200px, 1fr));
			}

			.listing li {
  			  	border: 1px solid #808080;
  			  	border-radius: 5px;
  			  	display: flex;
  			  	flex-direction: column;
			}
			
			.listing .cls_interes {
  			  	margin-top: auto;
  			  	border-top: 1px solid #808080;
  			  	padding: 5px;
  			  	text-align: center;
			}

			.listing .cls_cuota {
  			  	padding: 5px;
  			  	text-align: center;
			}
        </style>
        <title>FPP</title>
    </head>
    <body>
    	<ul class="encabezado">
    		<li>
  	    		<h2>Precio </h2>
  	    		<div class="cls_div"><input class="cls_input" type="number" id="precio" value="999"></div>
    		</li>
    		<li>
      		  	<h2>Meses</h2>
      			<div class="cls_div"><input  class="cls_input" type="number" id="meses" value="12"></div>
    		</li>
    		<li>
  	    		<h2 id="txt_meses">Personalizado </h2>
  	    		<div class="cls_cuota" id="cuota">Cuota: </div>
  	    		<div class="cls_interes" id="interes">Intereses: </div>
    		</li>
  	  	</ul>
		
  		<ul class="listing">
  		  	<li>
    		  	<h2>3 meses</h2>
    		  	<div class="cls_cuota" id="cuota_3">Cuota: </div>
    		  	<div class="cls_interes" id="interes_3">Intereses: </div>
  			</li>
   		 	<li>
     		   	<h2>6 meses</h2>
    			<div class="cls_cuota" id="cuota_6">Cuota: </div>
    			<div class="cls_interes" id="interes_6">Intereses: </div>
   		 	</li>
   		 	<li>
     		   	<h2>9 meses</h2>
    			<div class="cls_cuota" id="cuota_9">Cuota: </div>
    			<div class="cls_interes" id="interes_9">Intereses: </div>
    		</li>
    		<li>
     		   	<h2>12 meses</h2>
    			<div class="cls_cuota" id="cuota_12">Cuota: </div>
    			<div class="cls_interes" id="interes_12">Intereses: </div>
    		</li>
     	   	<li>
     		   	<h2>18 meses</h2>
    			<div class="cls_cuota" id="cuota_18">Cuota: </div>
    			<div class="cls_interes" id="interes_18">Intereses: </div>
    		</li>
     	   	<li>
     		   	<h2>24 meses</h2>
    			<div class="cls_cuota" id="cuota_24">Cuota: </div>
    			<div class="cls_interes" id="interes_24">Intereses: </div>
    		</li>
     	   	<li>
     		   	<h2>36 meses</h2>
    			<div class="cls_cuota" id="cuota_36">Cuota: </div>
    			<div class="cls_interes" id="interes_36">Intereses: </div>
    		</li>
    		<li>
  	    		<h2 id="txt_meses_ideal">Cuota 30€ </h2>
  	    		<div class="cls_cuota" id="cuota_ideal">Cuota:</div>
  	    		<div class="cls_interes" id="interes_ideal">Intereses: </div>
    		</li>
		</ul>

  	    <h1>Los valores son aproximados. Por favor, no imprim&aacute;is esta hoja.</h1>

        
		<script type="text/javascript">

  			var TIN = 16;

  			var edit_meses = document.getElementById("meses");
  	    	var edit_precio = document.getElementById("precio");
  	    	var txt_cuota = document.getElementById("cuota");
  	    	var txt_interes = document.getElementById("interes");
  	    	var txt_meses = document.getElementById("txt_meses");
  	    	var txt_meses_ideal = document.getElementById("txt_meses_ideal");
		
  			precio.addEventListener('input', updateValue);
  			meses.addEventListener('input', updateValue);
  			window.onload = inicia_script()
		
  			function redondea(valor){
              	return (Math.round((valor + Number.EPSILON) * 100) / 100);
  			}

  			function calcula_gastos(importe) {
  				gastos = 0;
  		    	if ((importe > 0) && (importe <= 90)) gastos = 1;
  		    	if ((importe > 90) && (importe <= 125)) gastos = 2;
  		    	if ((importe > 125) && (importe <= 250)) gastos = 3;
  		    	if ((importe > 250) && (importe <= 350)) gastos = 5;
  		    	if ((importe > 350) && (importe <= 600)) gastos = 7;
  		    	if ((importe > 600) && (importe <= 1000)) gastos = 9;
  		    	if (importe > 1000) gastos = 12;
  		    	return gastos;
  			}
		
         	function calcula_cuota(importe,meses){
  		  	  	importe = parseFloat(importe);
   		  	  	IndiceIntereses = TIN / 1200;
   		  	  	CalculoArriba = IndiceIntereses * (Math.pow((IndiceIntereses + 1), meses));
   		  	  	CalculoAbajo = Math.pow((IndiceIntereses + 1), meses) - 1;
  		  	  	cuota = (CalculoArriba / CalculoAbajo) * importe;
  		  	  	if (meses == 3) {
  			  	  	gastos = calcula_gastos(importe);
  			  	  	cuota = (importe + gastos) /3;
  		  	  	}
  		  	  	return cuota;
  	   	 	}
	   
  	   	 	function pinta_datos(valor_meses){
  		  	  	valor_cuota = calcula_cuota(precio.value,valor_meses);
   		  	  	intereses = (valor_cuota*valor_meses) - precio.value;
   		  	  	txt_cuota.innerHTML = "Cuota: "+ redondea(valor_cuota) + " €/m";
   		  	  	txt_interes.innerHTML = "Intereses: " + redondea(intereses) + " €";
		  	  	txt_meses.innerHTML = valor_meses + " meses"
  	   	 	}
	  
	   	 	function cerca_de_valor(importe, valor){
		   	 	diferencia_anterior = 1000;
		   	 	mejor_mes = 0;
		   	 	for (i=3;i<37;i++)
		   	 	{
			   	 	temp_calculo =calcula_cuota(importe, i);
			   	 	diferencia = temp_calculo - valor;
			   	 	if ((diferencia > 0) & (diferencia<diferencia_anterior)) 
				   	{
						diferencia_anterior=diferencia;
						mejor_mes = i;
					}
				}
				return mejor_mes;
			}
	   
			function pinta_mes_ideal()
	   	 	{
     			var txt_cuota_ideal = document.getElementById("cuota_ideal");
     			var txt_interes_ideal = document.getElementById("interes_ideal");
	   			mes_perfecto = cerca_de_valor(precio.value,30);
				if (mes_perfecto != 0)
				{
					valor_cuota = calcula_cuota(precio.value,mes_perfecto);
	 				intereses = (valor_cuota*mes_perfecto) - precio.value;
	 				txt_cuota_ideal.innerHTML = "Cuota: "+ redondea(valor_cuota) + " €/m";
	 				txt_interes_ideal.innerHTML = "Intereses: " + redondea(intereses) + " €";
		    		txt_meses_ideal.innerHTML = mes_perfecto + " meses";					
				}
				else
				{
	 				txt_cuota_ideal.innerHTML = "Cuota inferior";
	 				txt_interes_ideal.innerHTML = "a 30€/m";
		    		txt_meses_ideal.innerHTML = "Sin datos";						
				}

			}
	   
  	   	 	function pinta_todos_datos()
  	   	 	{
    	  	  	pinta_datos(edit_meses.value);
		  	  	pinta_mes_ideal();
   		  	  	const array = [ "3", "6", "9", "12", "18", "24", "36" ];
  	      	  	array.forEach(function (item, index) {
     	      	  	var cuota_array = document.getElementById("cuota_"+item);
     	      	  	var interes_array = document.getElementById("interes_"+item);
   		  		  	valor_cuota = calcula_cuota(precio.value,item);
    		  	  	intereses = (valor_cuota*item) - precio.value;
    		  	  	cuota_array.innerHTML = "Cuota: "+ redondea(valor_cuota) + " €/m";
    		  	  	interes_array.innerHTML = "Intereses: " + redondea(intereses) + " €";
				});
			}
	   
			function inicia_script()
	    	{
				edit_meses.value = localStorage.getItem("meses");
	     	   	edit_precio.value = localStorage.getItem("precio");
		 	   	if (edit_meses.value.length == 0) {
		 			edit_meses.value = 12
					edit_precio.value = 999
				}
				pinta_todos_datos();
			}
	   
			function updateValue(e) {
				if ((edit_meses.value.length > 0) & (edit_precio.value.length > 0)) 
				{
					if (edit_precio.value < 1) edit_precio.value=1;
					if (edit_meses.value < 1) edit_meses.value=1;
					if (edit_meses.value > 36) edit_meses.value=36;
					
					localStorage.setItem("meses", edit_meses.value);
					localStorage.setItem("precio", edit_precio.value);
					pinta_todos_datos();
				}
			}
			
		</script> 
	</body>
</html>
