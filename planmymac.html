<!DOCTYPE html>
<html lang="en" >

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta charset="UTF-8">
  <title>Plan My</title>
  

  
<style>
	
	.cuerpo {width: 80%;height: 100%;visibility: visible; display: all;  margin: 0 auto;}
	
	
		.resultado{
		    text-align: center;
            font-family: "Lucida Grande", Tahoma, Verdana, sans-serif;
            font-weight: normal;
            font-size: 2.5rem;
		}
	
        .switch-field {
            display: flex;
            margin-bottom: 5px;
            overflow: hidden;
            justify-content: center;
		    width: auto;
        }

        .switch-field input {
            position: absolute !important;
            clip: rect(0, 0, 0, 0);
            height: 1px;
            width: 1px;
            border: 0;
            overflow: hidden;
        }

        .switch-field label {
            background-color: #f2f2f2;
            color: rgba(0, 0, 0, 0.6);
            font-size: 1.5rem;
            line-height: 1;
            text-align: center;
            padding: calc(6px + 0.5vw) calc(5px + 2vw);
            margin-right: -1px;
            border: 1px solid rgba(0, 0, 0, 0.2);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px rgba(255, 255, 255, 0.1);
            transition: all 0.1s ease-in-out;
        }
		
		.switch-field label.tres {
			width: calc(33.33% - 5px);
		}

		.switch-field label.cuatro {
			width: calc(25% - 5px);
		}
		
		.switch-field label.cinco {
			width: calc(20% - 5px);
		}
		
        .switch-field label:hover {
            cursor: pointer;
        }

        .switch-field input:checked + label {
            background-color: #c1c1c1 ;
            box-shadow: none;
			color: #000000;
        }

        .switch-field input:disabled + label {
            background-color: #d9d9d9;
			color: #b8b8b8;
            box-shadow: none;
        }

        .switch-field label:first-of-type {
            border-radius: 4px 0 0 4px;
        }

        .switch-field label:last-of-type {
            border-radius: 0 4px 4px 0;
        }

        .form {
            font-family: "Lucida Grande", Tahoma, Verdana, sans-serif;
            font-weight: normal;
            line-height: 1.625;
			
            max-width: 100vw;
        }

        h2 {
            font-size: 2rem;
            margin-bottom: 1px;
        }

		@media only screen and (max-width: 600px) {	
			
			.cuerpo {width: 95%;height: 100%;visibility: visible; display: all;  margin: 0 auto;}
			
            .switch-field label {
                font-size: 0.8rem;
                padding: calc(7px + 0.7vw) calc(3px + 0.4vw);
            }
			.resultado{
	            font-size: 1.1rem;
			    text-align: left;
				
			}
	        h2 {
	            font-size: 1.5rem;
	            margin-bottom: 1px;
	        }
        }
		
		
		.link_precio:link, .link_precio:visited {
		  background-color: #f2f2f2;
		  color: black;
		  text-decoration: none;
		}

		.link_precio:hover, .link_precio:active {
		  background-color: gray;
		  color: white;
		}
		
		
		
		select {
		  // A reset of styles, including removing the default dropdown arrow
		  appearance: none;
		  background-color: #f2f2f2;
		  border: none;
		  padding: 0 1em 0 0;
		  margin: 0;
		  width: 100%;
		  font-family: inherit;
          font-size: 1.1rem;

		}

		select option {
		  margin: 40px;
		  background: rgba(50, 100, 0, 0.3);
		  color: #ddd;
		  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.4);
		}


    </style>

  
  
  
</head>

<body translate="no">
	<div class="cuerpo">
	
  <form class="form">


	<h2>Simulador Plan My</h2>
	<br>
	<div class="switch-field iphone">
		<input type="radio" id="ipad" name="boton-seleccion" value="ipad" />
		<label class="cuatro" for="ipad">iPad</label>
		<input type="radio" id="mac" name="boton-seleccion" value="macbook"/>
		<label class="cuatro" for="mac">Macbook</label>
		<input type="radio" id="imac" name="boton-seleccion" value="imac" />
		<label class="cuatro" for="imac">iMac</label>
		<input type="radio" id="macmini" name="boton-seleccion" value="macmini" />
		<label class="cuatro" for="macmini">Mini/Studio</label>
	</div>
	<div class="select">

  <select id="modelos"></select>
  

	</div>

	<br>
    <div id ='resultado' class="resultado"></div>
	

</form>
</div>
  
<script type="text/javascript">
	var datos_mac = '{"iMac 24-4.5K/M1/7GPU/8/256":{"PVP":1569, "VR":324.1735537190083},"iMac 24-4.5K/M1/8GPU/8/256":{"PVP":1799, "VR":371.6942148760331},"iMac 24-4.5K/M1/8GPU/8/512":{"PVP":2029, "VR":419.21487603305786},"iPad (9th) Cell 256Gb":{"PVP":799, "VR":132.06611570247935},"iPad (9th) Cell 64Gb":{"PVP":599, "VR":99.00826446280992},"iPad (9th) WI-FI 256Gb":{"PVP":629, "VR":103.96694214876034},"iPad (9th) WI-FI 64Gb":{"PVP":429, "VR":70.90909090909092},"iPad Air (5th) Cell 256Gb":{"PVP":1169, "VR":193.2231404958678},"iPad Air (5th) Cell 64Gb":{"PVP":969, "VR":160.16528925619835},"iPad Air (5th) Wifi 256Gb":{"PVP":969, "VR":160.16528925619835},"iPad Air (5th) Wifi 64Gb":{"PVP":769, "VR":127.10743801652893},"Mac Mini- M1/8/256":{"PVP":659, "VR":108.92561983471076},"Mac Mini- M1/8/512":{"PVP":889, "VR":146.94214876033058},"Mac Studio - M1(Max)/32/512Gb":{"PVP":2329, "VR":481.19834710743805},"Mac Studio - M1(Ultra)/64/1Tb":{"PVP":4629, "VR":956.404958677686},"Macbook Air 13 - M1/8/256":{"PVP":1219, "VR":201.48760330578514},"Macbook Air 13 - M2/8/256VER":{"PVP":1519, "VR":376.6115702479339},"Macbook Air 13 - M2/8/512VER":{"PVP":1869, "VR":463.3884297520661},"Macbook Pro 13 - M2/8/256VER":{"PVP":1619, "VR":401.40495867768595},"Macbook Pro 13 - M2/8/512VER":{"PVP":1849, "VR":458.4297520661157},"Macbook Pro 14 - M1(Pro)/16/1Tb":{"PVP":2634, "VR":435.37190082644634},"Macbook Pro 14 - M1(Pro)/16/512":{"PVP":2134, "VR":352.72727272727275},"Macbook Pro 16 - M1(Max)/32/1Tb":{"PVP":3619, "VR":598.1818181818182},"Macbook Pro 16 - M1(Pro)/16/1Tb":{"PVP":2749, "VR":454.3801652892562},"Macbook Pro 16 - M1(Pro)/16/512":{"PVP":2519, "VR":416.36363636363643},"iPad Pro 11 (4th) Wifi 128":{"PVP":1049, "VR":173.38842975206614},"iPad Pro 11 (4th) Wifi 256":{"PVP":1179, "VR":194.87603305785126},"iPad Pro 11 (4th) Wifi 512":{"PVP":1429, "VR":236.19834710743805},"iPad Pro 11 (4th) Wifi 1Tb":{"PVP":1929, "VR":318.8429752066116},"iPad Pro 11 (4th) Wifi 2Tb":{"PVP":2429, "VR":401.4876033057851},"iPad Pro 11 (4th) Cell 128":{"PVP":1249, "VR":206.44628099173556},"iPad Pro 11 (4th) Cell 256":{"PVP":1379, "VR":227.93388429752068},"iPad Pro 11 (4th) Cell 512":{"PVP":1629, "VR":269.2561983471075},"iPad Pro 11 (4th) Cell 1Tb":{"PVP":2129, "VR":351.90082644628103},"iPad Pro 11 (4th) Cell 2Tb":{"PVP":2629, "VR":434.5454545454546},"iPad Pro 12 (6th) Wifi 128":{"PVP":1449, "VR":239.50413223140495},"iPad Pro 12 (6th) Wifi 256":{"PVP":1579, "VR":260.9917355371901},"iPad Pro 12 (6th) Wifi 512":{"PVP":1829, "VR":302.3140495867769},"iPad Pro 12 (6th) Wifi 1Tb":{"PVP":2329, "VR":384.9586776859505},"iPad Pro 12 (6th) Wifi 2Tb":{"PVP":2829, "VR":467.60330578512395},"iPad Pro 12 (6th) Cell 128":{"PVP":1649, "VR":272.56198347107437},"iPad Pro 12 (6th) Cell 256":{"PVP":1779, "VR":294.0495867768595},"iPad Pro 12 (6th) Cell 512":{"PVP":2029, "VR":335.37190082644634},"iPad Pro 12 (6th) Cell 1Tb":{"PVP":2524, "VR":417.1900826446281},"iPad Pro 12 (6th) Cell 2Tb":{"PVP":3024, "VR":499.8347107438017},"iPad (10th) Wifi 64Gb":{"PVP":579, "VR":95.70247933884298},"iPad (10th) Wifi 256Gb":{"PVP":779, "VR":128.7603305785124},"iPad (10th) Cell 64Gb":{"PVP":779, "VR":128.7603305785124},"iPad (10th) Cell 256Gb":{"PVP":979, "VR":161.81818181818184},"Mac Mini- M2/8/256":{"PVP":719, "VR":148.55371900826447},"Mac Mini- M2/8/512":{"PVP":949, "VR":196.07438016528926},"Mac Mini- M2(Pro)/16/512":{"PVP":1569, "VR":324.1735537190083},"Macbook Pro 14- M2(Pro)/16/512":{"PVP":2449, "VR":607.1900826446281},"Macbook Pro 14- M2(Pro)/16/1Tb":{"PVP":3049, "VR":755.9504132231405},"Macbook Pro 14- M2(Max)/32/1Tb":{"PVP":3749, "VR":929.504132231405},"Macbook Pro 16- M2(Pro)/16/512":{"PVP":3049, "VR":755.9504132231405},"Macbook Pro 16- M2(Pro)/16/1Tb":{"PVP":3279, "VR":812.9752066115703},"Macbook Pro 16- M2(Max)/32/1Tb":{"PVP":4199, "VR":1041.0743801652893}}';
    var json_mac = JSON.parse(datos_mac);
    var todos_modelos = Object.keys(json_mac);
	if (document.querySelector('input[name="boton-seleccion"]')) {
	  document.querySelectorAll('input[name="boton-seleccion"]').forEach((elem) => {
	    elem.addEventListener("change", actualiza);
	  });
	}
	
	var labels = document.getElementsByTagName('label');
	for (var i = 0; i < labels.length; i++) {
	    if (labels[i].htmlFor != '') {
	         var elem = document.getElementById(labels[i].htmlFor);
	         if (elem)
	            elem.label = labels[i];         
	    }
	}
	

	
	function MeteModelosCombo(modelo){
		var modelos = document.querySelector('#modelos');
		for (var i = 0; i < todos_modelos.length; i++) {
        	if (todos_modelos[i].includes(modelo))
			{
				var data = document.createElement('option');
        		data.text = todos_modelos[i];
        		modelos.add(data);
			}
    	}
    }
	
    function redondea(valor){
        if (Number.EPSILON === undefined) {
            Number.EPSILON = Math.pow(2, -52); //Hay que meter esto para que funcione en IE11
            }
        return (Math.round((valor + Number.EPSILON) * 100) / 100);
    }
	
	function CambiarPrecio(precio) {
		let modelos = document.querySelector('#modelos').selection;

		let nuevo_precio = parseInt(prompt("Introduce el precio", precio));

		if (nuevo_precio != null && !isNaN(nuevo_precio)) {
			dibujaCuota(null,nuevo_precio);
		}
	}
	
	function BorraCombo() {
	   var modelos = document.querySelector('#modelos');
	   var i, L = modelos.options.length - 1;
	   for(i = L; i >= 0; i--) {
	      modelos.remove(i);
	   }
	}
	
    function actualiza(e) {
		var item = event.target.value;
		if (item=='imac'){
			BorraCombo();
			MeteModelosCombo('iMac');
		}
		if (item=='macbook'){
			BorraCombo();
			
			MeteModelosCombo('Macbook');

 	   }
	   if (item=='ipad'){
		   BorraCombo();
		   
		   MeteModelosCombo('iPad');
	   }
	   if (item=='macmini'){
		   BorraCombo();
		   
		   MeteModelosCombo('Mac Mini');
		   MeteModelosCombo('Mac Studio');
		   
	   }

       function dibujaCuota(modelo, nuevo_precio) {

					
					console.log('*'+modelo+'');
					if (nuevo_precio == null) {
				  		precio = json_mac[modelo].PVP;
			  		}
				  	else
					{
				  		precio = nuevo_precio;
				  	}
				  
				  fv = json_mac[modelo].VR;
				  rate = 6.95/100/12;
				  nper = 36;
				  pv = -precio-18;
			      pvif = Math.pow(1 + rate, nper);
			      pmt = - rate * (pv * pvif + fv) / (pvif - 1);
				  intereses = ((pmt*nper)+fv)-precio;
                  codigo_enlace = '<a class="link_precio" title="Pulsa para modificar el precio" href="#" onclick="CambiarPrecio(' + precio+');return false;">'
				  texto_resultado =  'Precio: '+codigo_enlace+'<b>'+precio+"</b> €</a><br/>";
				  texto_resultado += 'Cuota: <b>'+ redondea(pmt) + ' €/m</b><br />';
				  texto_resultado += 'Última cuota: '+fv+' €<br />';
				  texto_resultado += 'Intereses + gastos: '+redondea(intereses)+ '€<br />';
				  texto_resultado += 'Meses: '+nper+' (+1) meses';
				  
				  texto_resultado = modelo + ': '+codigo_enlace+'<b>'+precio+" €</b></a><br/>";
				  texto_resultado += nper +' cuotas de <b>'+redondea(pmt)+ '€</b><br>';
				  texto_resultado += 'Y una última cuota de <b>'+redondea(fv)+' €</b><br>';
				  texto_resultado += 'Pagando <b>'+redondea(intereses)+ ' €</b> de intereses (incluido en la cuota)';
				  
				  
                  var txt_resultado = document.getElementById("resultado");
                  txt_resultado.innerHTML = texto_resultado;
			  }
			 
		  	function actualizaCombo(e){
		  		var item = event.target.value;
		  		dibujaCuota(item);
		
		  		console.log(item);
		  	}
			
			document.querySelector('#modelos').addEventListener("change", actualizaCombo);
			
  };
</script>
  
  
</body>

</html>